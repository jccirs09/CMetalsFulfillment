@page "/Account/Login"
@layout CMetalsFulfillment.Components.Layout.EmptyLayout
@attribute [Microsoft.AspNetCore.Authorization.AllowAnonymous]

@using System.ComponentModel.DataAnnotations
@using CMetalsFulfillment.Data
@using Microsoft.AspNetCore.Components.Forms
@using MudBlazor

@inject NavigationManager NavigationManager

<PageTitle>Log in</PageTitle>

<MudGrid Justify="Justify.Center" Class="mt-16">
    <MudItem xs="12" sm="8" md="6" lg="4">
        <MudCard Elevation="4">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h5" Align="Align.Center">MetalFlow Login</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                @if (ErrorMessage is not null)
                {
                    <MudAlert Severity="Severity.Error" Class="mb-4">@ErrorMessage</MudAlert>
                }

                <form action="Account/Login?returnUrl=@ReturnUrl" method="post">
                    <AntiforgeryToken />

                    <MudStack Spacing="3">
                        <!-- Email Field -->
                        <MudTextField @bind-Value="email" Label="Email" InputType="InputType.Email" Variant="Variant.Outlined" FullWidth="true" Required="true" />
                        <input type="hidden" name="Email" value="@email" />

                        <!-- Password Field -->
                        <MudTextField @bind-Value="password" Label="Password" InputType="InputType.Password" Variant="Variant.Outlined" FullWidth="true" Required="true" />
                        <input type="hidden" name="Password" value="@password" />

                        <!-- Remember Me -->
                        <div class="d-flex align-center">
                            <MudCheckBox @bind-Value="rememberMe" Label="Remember me" Color="Color.Primary" />
                        </div>
                        <!-- Hidden inputs for RememberMe checkbox logic -->
                        @if (rememberMe)
                        {
                            <input type="hidden" name="RememberMe" value="true" />
                        }
                        <input type="hidden" name="RememberMe" value="false" />

                        <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Size="Size.Large" FullWidth="true" Class="mt-4">
                            Log in
                        </MudButton>
                    </MudStack>
                </form>
            </MudCardContent>
            <MudCardActions Class="d-flex justify-center flex-column pb-4">
                 <MudLink Href="Account/ForgotPassword" Typo="Typo.body2">Forgot your password?</MudLink>
            </MudCardActions>
        </MudCard>
    </MudItem>
</MudGrid>

@code {
    [SupplyParameterFromQuery]
    private string? ReturnUrl { get; set; }

    [SupplyParameterFromQuery(Name = "error")]
    private string? ErrorMessage { get; set; }

    private string email = "";
    private string password = "";
    private bool rememberMe = false;
}
