@page "/Account/Login"
@layout CMetalsFulfillment.Components.Layout.EmptyLayout
@attribute [Microsoft.AspNetCore.Authorization.AllowAnonymous]

@using System.ComponentModel.DataAnnotations
@using CMetalsFulfillment.Data
@using Microsoft.AspNetCore.Components.Forms
@using MudBlazor

@inject NavigationManager NavigationManager

<PageTitle>Log in</PageTitle>

<MudGrid Justify="Justify.Center" Class="mt-16">
    <MudItem xs="12" sm="8" md="6" lg="4">
        <MudCard Elevation="4">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h5" Align="Align.Center">MetalFlow Login</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                @if (ErrorMessage is not null)
                {
                    <MudAlert Severity="Severity.Error" Class="mb-4">@ErrorMessage</MudAlert>
                }

                <form action="Account/Login?returnUrl=@ReturnUrl" method="post">
                    <AntiforgeryToken />

                    <MudStack Spacing="2">
                        <!-- Standard HTML Inputs for reliable Form POST -->
                        <div class="form-group mb-3">
                            <label class="mud-input-label">Email</label>
                            <input type="email" name="Email" class="form-control mud-input-slot mud-input-root mud-input-root-outlined" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;" required />
                        </div>

                         <div class="form-group mb-3">
                             <label class="mud-input-label">Password</label>
                            <input type="password" name="Password" class="form-control mud-input-slot mud-input-root mud-input-root-outlined" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;" required />
                        </div>

                        <div class="d-flex align-center mt-2">
                             <input type="checkbox" name="RememberMe" value="true" id="rememberMe" />
                             <label for="rememberMe" class="ml-2 mud-typography mud-typography-body1">Remember me</label>
                        </div>
                        <input type="hidden" name="RememberMe" value="false" />

                        <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Size="Size.Large" FullWidth="true" Class="mt-4">
                            Log in
                        </MudButton>
                    </MudStack>
                </form>
            </MudCardContent>
            <MudCardActions Class="d-flex justify-center flex-column pb-4">
                 <MudLink Href="Account/ForgotPassword" Typo="Typo.body2">Forgot your password?</MudLink>
            </MudCardActions>
        </MudCard>
    </MudItem>
</MudGrid>

@code {
    [SupplyParameterFromQuery]
    private string? ReturnUrl { get; set; }

    [SupplyParameterFromQuery(Name = "error")]
    private string? ErrorMessage { get; set; }
}
